<!DOCTYPE html>
<html lang="fr">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Conversion de Freebet</title>
    <style>
        body {
            font-family: Arial, sans-serif;
        }
        table {
            width: 100%;
            border-collapse: collapse;
            margin-bottom: 20px;
        }
        table, th, td {
            border: 1px solid black;
        }
        th {
            background-color: #cce5ff; /* Fond bleu clair pour l'entête */
            color: black;
        }
        th, td {
            padding: 8px;
            text-align: center;
        }
        .input-table {
            margin-bottom: 20px;
        }
        #detailsMises {
            display: none; /* Cache le tableau des mises au chargement */
        }
        #resultats {
            display: none; /* Cache les résultats au chargement */
        }
        input[type="number"], input[type="text"] {
            width: 80px;
            text-align: center;
        }
        .btn-reset, .btn-edit, .btn-delete {
            padding: 10px 20px;
            margin-top: 10px;
            margin-bottom: 20px; /* Espace sous les boutons */
            background-color: #4CAF50;
            color: white;
            border: none;
            border-radius: 8px; /* Coins arrondis */
            cursor: pointer;
            font-size: 16px;
            transition: background-color 0.3s;
        }
        .btn-reset:hover, .btn-edit:hover, .btn-delete:hover {
            background-color: #45a049; /* Changement de couleur au survol */
        }
        .btn-delete {
            background-color: #f44336; /* Rouge pour supprimer */
        }
        .edit-equipes-container {
            display: none;
            margin-top: 20px;
        }
        .edit-equipes-container input {
            margin: 5px;
        }
        .error-message {
            color: red;
            font-size: 14px;
        }
    </style>
</head>
<body>

<h1>Conversion de Freebet</h1>

<!-- Choisir le nombre de matchs -->
<div>
    <label for="nbMatchs">Nombre de matchs :</label>
    <select id="nbMatchs" onchange="ajusterNombreDeMatchs()">
        <option value="2">2 Matchs</option>
        <option value="3" selected>3 Matchs</option>
        <option value="4">4 Matchs</option>
    </select>
</div>

<!-- Tableau des entrées de cotes -->
<h2>Saisir les cotes des matchs</h2>
<table class="input-table" id="tableCotes">
    <thead>
        <tr>
            <th>Match</th>
            <th>Cote 1</th>
            <th>Cote N</th>
            <th>Cote 2</th>
            <th>TRJ (%)</th>
        </tr>
    </thead>
    <tbody id="bodyCotes">
        <!-- Lignes de cotes générées dynamiquement ici -->
    </tbody>
</table>

<!-- Boutons pour réinitialiser les cotes, éditer et supprimer les équipes -->
<button class="btn-reset" onclick="resetCotes()">Réinitialiser les cotes</button>
<button class="btn-edit" onclick="afficherEditionEquipes()">Éditer les équipes</button>
<button class="btn-delete" id="btnSupprimerEquipes" style="display:none;" onclick="supprimerEquipes()">Supprimer les équipes</button>

<!-- Formulaire pour l'édition des équipes -->
<div class="edit-equipes-container" id="editEquipesContainer">
    <h3>Éditer les équipes</h3>
    <div id="inputEquipes">
        <!-- Lignes pour les équipes générées dynamiquement ici -->
    </div>
    <button class="btn-edit" onclick="validerEquipes()">Valider</button>
    <button class="btn-reset" onclick="annulerEdition()">Annuler</button>
    <div class="error-message" id="errorEquipes" style="display: none;">Veuillez remplir toutes les cases pour les équipes.</div>
</div>

<div>
    <label>Gain désiré :</label>
    <input type="number" id="gainDesire" value="100">
</div>

<!-- Affichage des résultats : Mise totale et Taux de conversion -->
<div id="resultats">
    <h2>
        Mise totale en Freebets : <span id="totalMise">0</span> € 
        <br> 
        Taux de conversion : <span id="tauxConversion">0</span> %
    </h2>
</div>

<!-- Tableau des détails des mises -->
<div id="detailsMises">
    <h3>Détails des Mises</h3>
    <table>
        <thead>
            <tr>
                <th>#</th>
                <th>Combinaison</th>
                <th>Cote</th>
                <th>Mise</th>
                <th>Gain net</th>
            </tr>
        </thead>
        <tbody id="detailMises">
        </tbody>
    </table>
</div>

<script>
let equipes = {};
let nombreDeMatchs = 3;
let equipesEditees = false; // Pour suivre si les équipes ont été éditées

function ajusterNombreDeMatchs() {
    nombreDeMatchs = parseInt(document.getElementById('nbMatchs').value);
    genererTableauCotes();
    genererFormulaireEquipes();
    resetCotes();
}

function genererTableauCotes() {
    const bodyCotes = document.getElementById('bodyCotes');
    bodyCotes.innerHTML = ''; // Vider le tableau

    for (let i = 1; i <= nombreDeMatchs; i++) {
        const row = document.createElement('tr');
        row.innerHTML = `
            <th id="match${i}Header">Match ${i}</th>
            <td><input type="number" id="cote1Match${i}" placeholder="Cote 1" oninput="mettreAJourTRJ(); calculerMises();"></td>
            <td><input type="number" id="coteNMatch${i}" placeholder="Cote N" oninput="mettreAJourTRJ(); calculerMises();"></td>
            <td><input type="number" id="cote2Match${i}" placeholder="Cote 2" oninput="mettreAJourTRJ(); calculerMises();"></td>
            <td><span id="trjMatch${i}">0</span></td>
        `;
        bodyCotes.appendChild(row);
    }
}

function genererFormulaireEquipes() {
    const inputEquipes = document.getElementById('inputEquipes');
    inputEquipes.innerHTML = ''; // Vider le formulaire des équipes

    for (let i = 1; i <= nombreDeMatchs; i++) {
        const div = document.createElement('div');
        div.innerHTML = `
            <label>Équipe 1 (domicile) :</label>
            <input type="text" id="equipe1Match${i}" placeholder="Équipe 1">
            <label>Équipe 2 (extérieur) :</label>
            <input type="text" id="equipe2Match${i}" placeholder="Équipe 2">
        `;
        inputEquipes.appendChild(div);
    }
}

function afficherEditionEquipes() {
    const container = document.getElementById('editEquipesContainer');
    container.style.display = container.style.display === 'none' || container.style.display === '' ? 'block' : 'none';
}

function validerEquipes() {
    let erreurs = false;
    for (let i = 1; i <= nombreDeMatchs; i++) {
        const equipe1 = document.getElementById(`equipe1Match${i}`).value;
        const equipe2 = document.getElementById(`equipe2Match${i}`).value;
        if (!equipe1 || !equipe2) {
            erreurs = true;
        }
        equipes[i] = { equipe1, equipe2 };
    }

    if (erreurs) {
        document.getElementById('errorEquipes').style.display = 'block';
        return;
    }

    equipesEditees = true;  // Marquer les équipes comme éditées
    document.getElementById('errorEquipes').style.display = 'none';
    document.getElementById('editEquipesContainer').style.display = 'none';
    document.getElementById('btnSupprimerEquipes').style.display = 'inline-block';

    for (let i = 1; i <= nombreDeMatchs; i++) {
        document.getElementById(`match${i}Header`).innerText = `${equipes[i].equipe1} vs ${equipes[i].equipe2}`;
    }
    calculerMises();
}

function annulerEdition() {
    document.getElementById('editEquipesContainer').style.display = 'none';
}

function resetCotes() {
    for (let i = 1; i <= nombreDeMatchs; i++) {
        document.getElementById(`cote1Match${i}`).value = '';
        document.getElementById(`coteNMatch${i}`).value = '';
        document.getElementById(`cote2Match${i}`).value = '';
        document.getElementById(`trjMatch${i}`).innerText = '0';
    }
    supprimerEquipes();
    document.getElementById('detailsMises').style.display = 'none';  // Cacher le tableau des mises
    document.getElementById('resultats').style.display = 'none';  // Cacher les résultats
}

function supprimerEquipes() {
    equipes = {};
    equipesEditees = false;  // Marquer les équipes comme non éditées
    for (let i = 1; i <= nombreDeMatchs; i++) {
        document.getElementById(`match${i}Header`).innerText = `Match ${i}`;
    }
    document.getElementById('btnSupprimerEquipes').style.display = 'none';
    calculerMises();
}

function mettreAJourTRJ() {
    for (let i = 1; i <= nombreDeMatchs; i++) {
        const cote1 = parseFloat(document.getElementById(`cote1Match${i}`).value) || 0;
        const coteN = parseFloat(document.getElementById(`coteNMatch${i}`).value) || 0;
        const cote2 = parseFloat(document.getElementById(`cote2Match${i}`).value) || 0;
        const trj = calculerTRJ(cote1, coteN, cote2);
        document.getElementById(`trjMatch${i}`).innerText = (trj * 100).toFixed(2);
    }
}

function calculerTRJ(cote1, coteN, cote2) {
    if (cote1 > 0 && coteN > 0 && cote2 > 0) {
        return 1 / ((1 / cote1) + (1 / coteN) + (1 / cote2));
    }
    return 0;
}

function calculerMises() {
    const gainDesire = parseFloat(document.getElementById('gainDesire').value);
    if (!toutesLesCotesRemplies()) return;

    const combinaisons = genererCombinaisons(nombreDeMatchs);
    let totalMise = 0;
    const tbody = document.getElementById('detailMises');
    tbody.innerHTML = '';

    combinaisons.forEach((combinaison, index) => {
        let cote = 1;
        let description = equipesEditees ? getDescriptionCombinaison(combinaison) : '';  // N'ajouter la description que si les équipes sont éditées
        for (let i = 0; i < combinaison.length; i++) {
            const result = combinaison[i];
            cote *= parseFloat(document.getElementById(`cote${result}Match${i + 1}`).value);
        }
        const mise = (gainDesire / (cote - 1)).toFixed(2);
        totalMise += parseFloat(mise);

        const row = `
            <tr>
                <td>${index + 1}</td>
                <td>${combinaison}${description ? ' - ' + description : ''}</td>
                <td>${cote.toFixed(2)}</td>
                <td>${mise} €</td>
                <td>${((cote - 1) * mise).toFixed(2)} €</td>
            </tr>
        `;
        tbody.innerHTML += row;
    });

    document.getElementById('totalMise').innerText = totalMise.toFixed(2);
    document.getElementById('tauxConversion').innerText = ((gainDesire / totalMise) * 100).toFixed(2);
    afficherOuMasquerTableau();
}

function getDescriptionCombinaison(combinaison) {
    let description = '';
    for (let i = 0; i < combinaison.length; i++) {
        if (combinaison[i] === '1') {
            description += equipes[i + 1]?.equipe1 || 'Equipe1';
        } else if (combinaison[i] === 'N') {
            description += 'Nul';
        } else if (combinaison[i] === '2') {
            description += equipes[i + 1]?.equipe2 || 'Equipe2';
        }
        if (i < combinaison.length - 1) {
            description += ' / ';
        }
    }
    return description;
}

function toutesLesCotesRemplies() {
    for (let i = 1; i <= nombreDeMatchs; i++) {
        if (!document.getElementById(`cote1Match${i}`).value || !document.getElementById(`coteNMatch${i}`).value || !document.getElementById(`cote2Match${i}`).value) {
            return false;
        }
    }
    return true;
}

function genererCombinaisons(nbMatchs) {
    const resultats = ['1', 'N', '2'];
    const combinaisons = [];

    const genererCombinaison = (combinaison, niveau) => {
        if (niveau === nbMatchs) {
            combinaisons.push(combinaison);
            return;
        }
        for (let i = 0; i < resultats.length; i++) {
            genererCombinaison(combinaison + resultats[i], niveau + 1);
        }
    };

    genererCombinaison('', 0);
    return combinaisons;
}

function afficherOuMasquerTableau() {
    const detailsMises = document.getElementById('detailsMises');
    const resultats = document.getElementById('resultats');
    if (toutesLesCotesRemplies()) {
        detailsMises.style.display = 'block';
        resultats.style.display = 'block';
    } else {
        detailsMises.style.display = 'none';
        resultats.style.display = 'none';
    }
}

// Appel initial pour générer le tableau
ajusterNombreDeMatchs();

</script>

</body>
</html>
